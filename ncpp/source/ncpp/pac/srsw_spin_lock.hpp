#pragma once

/** @file ncpp/pac/srsw_spin_lock.hpp
*	@brief Implement srsw_spin_lock
*/



//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////



#pragma region Includes

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

#include <ncpp/prerequisites.hpp>

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

#include <ncpp/utilities/.hpp>

#pragma endregion



//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////



namespace ncpp {

    namespace pac {

        class F_srsw_spin_lock {
            
        private:
            aflag is_locked_;
            
            
            
        public:
NCPP_DISABLE_ALL_WARNINGS_PUSH
            NCPP_FORCE_INLINE F_srsw_spin_lock() noexcept :
                is_locked_(ATOMIC_FLAG_INIT)
NCPP_DISABLE_ALL_WARNINGS_POP
            {
                
                
                
            }
            ~F_srsw_spin_lock() {
                
                
                
            }
            
            
            
        public:
            NCPP_FORCE_INLINE void lock() noexcept {
                
                while(is_locked_.test_and_set(eastl::memory_order_acquire));
                
            }
            NCPP_FORCE_INLINE b8 try_lock() noexcept {
                
                return !is_locked_.test_and_set(eastl::memory_order_acquire);
            }
            NCPP_FORCE_INLINE void unlock() noexcept {

                NCPP_ASSERT(is_locked_.test(eastl::memory_order_acquire)) << "srsw_spin lock is not locked";
                
                is_locked_.clear(eastl::memory_order_release);
            }



            NCPP_FORCE_INLINE void rlock() noexcept {

                unlock();
            }
            NCPP_FORCE_INLINE b8 try_rlock() noexcept {

                return try_lock();
            }
            NCPP_FORCE_INLINE void runlock() noexcept {

                unlock();
            }



            NCPP_FORCE_INLINE void wlock() noexcept {

                unlock();
            }
            NCPP_FORCE_INLINE b8 try_wlock() noexcept {

                return try_lock();
            }
            NCPP_FORCE_INLINE void wunlock() noexcept {

                unlock();
            }
            
        };

    }

}

